<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Badminton Fee Manager - Wide Name Edition</title>
    <style>
        :root { --primary: #1a73e8; --bg: #f8f9fa; --danger: #ff4d4f; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; font-size: 14px; }
        .container { max-width: 100%; margin: auto; }
        
        .app-title { text-align: center; background: var(--primary); color: white; padding: 15px; border-radius: 12px 12px 0 0; font-weight: 800; font-size: 16px; letter-spacing: 1px; }

        .sticky-header { position: sticky; top: 0; background: white; z-index: 100; padding: 12px; border-radius: 0 0 16px 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .input-group { display: flex; flex-direction: column; align-items: center; }
        label { font-size: 10px; font-weight: 700; color: #666; margin-bottom: 4px; text-transform: uppercase; }
        .header-input { width: 100%; padding: 10px; border: 1.5px solid #ddd; border-radius: 8px; font-size: 18px; font-weight: bold; text-align: center; box-sizing: border-box; color: var(--primary); }

        /* Row th√†nh vi√™n - T·ªëi ∆∞u l·∫°i t·ªâ l·ªá */
        .member-row { 
            background: white; margin-bottom: 6px; padding: 8px; border-radius: 10px; 
            display: flex; align-items: center; gap: 6px; border: 1px solid #eee;
        }

        /* √î T√™n: Chi·∫øm 6 ph·∫ßn (R·ªông nh·∫•t) */
        .m-name { flex: 6; font-size: 15px; padding: 10px 8px; border: 1.5px solid #ddd; border-radius: 6px; min-width: 0; font-weight: 600; }
        
        /* √î S·ªë & Ph√∫t: Thu nh·ªè l·∫°i (Ch·ªâ chi·∫øm 1 ph·∫ßn m·ªói √¥) */
        .m-count { width: 45px; font-size: 15px; text-align: center; padding: 10px 0; border: 1.5px solid #ddd; border-radius: 6px; background: #e8f0fe; font-weight: 800; color: #1a73e8; flex-shrink: 0; }
        .m-time { width: 55px; font-size: 15px; text-align: center; padding: 10px 0; border: 1.5px solid #ddd; border-radius: 6px; background: #fffde7; font-weight: 800; color: #f57f17; flex-shrink: 0; }
        
        .btn-del { 
            background: #fff; color: var(--danger); border: 1.5px solid #ffccc7; 
            width: 32px; height: 32px; border-radius: 50%; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0;
        }

        .options-box { background: #fff; padding: 12px; border-radius: 12px; margin: 10px 0; display: flex; justify-content: space-around; border: 1px solid #ddd; }
        .option-item { display: flex; align-items: center; gap: 6px; font-weight: 700; font-size: 12px; color: #444; }
        .option-item input { width: 18px; height: 18px; }

        .actions { margin-top: 10px; }
        button.main-btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-weight: bold; font-size: 16px; cursor: pointer; margin-bottom: 8px; }
        .btn-add { background: #fff; border: 2px dashed var(--primary); color: var(--primary); }
        .btn-calc { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(26,115,232,0.3); }
        
        /* B·∫£ng Bill */
        #ketQua { margin-top: 15px; display: none; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; font-size: 14px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #f0f0f0; padding: 12px 8px; text-align: center; }
        th { background: #fafafa; color: #888; font-size: 10px; font-weight: 800; }
        .summary-row { background: #f0f7ff; font-weight: bold; color: #0056b3; }
        .total-row { font-weight: 900; background: #f6ffed; color: #389e0d; }
        .profit-row { background: #fff7e6; color: #d46b08; font-weight: 900; border-top: 2px solid #ffd591; }
        .copy-btn { background: #52c41a; color: white; margin-bottom: 40px; }
        .hide-col { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="app-title">üè∏ BADMINTON FEE MANAGER</div>
    
    <div class="sticky-header">
        <div class="input-grid">
            <div class="input-group">
                <label>S·ªê S√ÇN</label>
                <input type="number" id="soSan" class="header-input" value="1">
            </div>
            <div class="input-group">
                <label>GI·ªú/S√ÇN</label>
                <input type="number" id="soGio" class="header-input" value="2">
            </div>
            <div class="input-group">
                <label>S·ªê C·∫¶U</label>
                <input type="number" id="soCau" class="header-input" value="10">
            </div>
        </div>
    </div>

    <div id="memberList"></div>

    <div class="options-box">
        <label class="option-item"><input type="checkbox" id="optCount" checked> HI·ªÜN SL</label>
        <label class="option-item"><input type="checkbox" id="optTime" checked> HI·ªÜN PH√öT</label>
    </div>

    <div class="actions">
        <button class="main-btn btn-add" onclick="addMember('', 1, 120)">+ TH√äM NH√Ä / NG∆Ø·ªúI</button>
        <button class="main-btn btn-calc" onclick="tinhTien()">XU·∫§T BILL & L√ÄM TR√íN</button>
        <button id="btnCopy" class="main-btn copy-btn" style="display:none" onclick="copyBill()">SAO CH√âP BILL</button>
    </div>

    <div id="ketQua">
        <table id="billTable">
            <thead>
                <tr>
                    <th style="text-align:left; padding-left:15px;">T√äN</th>
                    <th class="col-count">SL</th>
                    <th class="col-time">PH√öT</th>
                    <th>TI·ªÄN ($)</th>
                </tr>
            </thead>
            <tbody id="billBody"></tbody>
        </table>
    </div>
</div>

<script>
    const GIA_SAN_1H = 22;
    const GIA_CAU_1Q = 2.5;

    const danhSachGoc = [
        {n: "Nh√† Kh∆∞∆°ng", c: 4}, {n: "Nh√† H√†", c: 2}, {n: "Ph√°t", c: 1},
        {n: "Sam", c: 1}, {n: "T√¢n", c: 1}, {n: "Nh√† T√®o", c: 2},
        {n: "Nh√† Tu·∫•n", c: 2}, {n: "Anthony", c: 1}, {n: "Ho√†ng", c: 1}, {n: "H·∫£i", c: 1}
    ];

    const listDiv = document.getElementById('memberList');

    function addMember(name="", count=1, time=120) {
        const div = document.createElement('div');
        div.className = 'member-row';
        div.innerHTML = `
            <input type="text" class="m-name" value="${name}" placeholder="T√™n">
            <input type="number" class="m-count" value="${count}">
            <input type="number" class="m-time" value="${time}">
            <button class="btn-del" onclick="this.parentElement.remove()">‚úï</button>
        `;
        listDiv.appendChild(div);
    }

    danhSachGoc.forEach(i => addMember(i.n, i.c, 120));

    function tinhTien() {
        const soSan = parseFloat(document.getElementById('soSan').value) || 0;
        const soGio = parseFloat(document.getElementById('soGio').value) || 0;
        const soCau = parseFloat(document.getElementById('soCau').value) || 0;
        const showCount = document.getElementById('optCount').checked;
        const showTime = document.getElementById('optTime').checked;

        const tienSanGoc = soSan * soGio * GIA_SAN_1H;
        const tienCauGoc = soCau * GIA_CAU_1Q;
        const tongGoc = (tienSanGoc + tienCauGoc).toFixed(1);
        
        const names = document.getElementsByClassName('m-name');
        const counts = document.getElementsByClassName('m-count');
        const times = document.getElementsByClassName('m-time');

        let totalP = 0, totalMinPts = 0, groups = [];

        for (let i = 0; i < names.length; i++) {
            let n = names[i].value.trim();
            if (n) {
                let c = parseFloat(counts[i].value) || 0;
                let t = parseFloat(times[i].value) || 0;
                totalP += c;
                totalMinPts += (c * t);
                groups.push({n, c, t});
            }
        }

        if (totalMinPts === 0) return;

        const pricePerMin = tienSanGoc / totalMinPts;
        const pricePerShuttle = totalP > 0 ? (tienCauGoc / totalP) : 0;

        let tableHtml = "";
        let realTotal = 0;

        groups.forEach(g => {
            let cost = (g.c * g.t * pricePerMin) + (g.c * pricePerShuttle);
            let rounded = Math.ceil(cost * 10) / 10;
            realTotal += rounded;
            
            tableHtml += `<tr>
                <td style="text-align:left; padding-left:15px; font-weight:600;">${g.n}</td>
                <td class="col-count ${showCount ? '' : 'hide-col'}">${g.c}</td>
                <td class="col-time ${showTime ? '' : 'hide-col'}">${g.t}</td>
                <td style="font-weight:800;">${rounded.toFixed(1)}</td>
            </tr>`;
        });
        
        const spanCol = (showCount?1:0) + (showTime?1:0) + 1;
        tableHtml += `<tr class="summary-row"><td colspan="${spanCol}" style="text-align:right">G·ªêC (${totalP} ng∆∞·ªùi | ${soCau} c·∫ßu):</td><td>$${tongGoc}</td></tr>`;
        tableHtml += `<tr class="total-row"><td colspan="${spanCol}" style="text-align:right">TH·ª∞C THU:</td><td>$${realTotal.toFixed(1)}</td></tr>`;
        tableHtml += `<tr class="profit-row"><td colspan="${spanCol}" style="text-align:right">D∆Ø (L·ªúI):</td><td>$${(realTotal - tongGoc).toFixed(1)}</td></tr>`;

        document.querySelector('.col-count').classList.toggle('hide-col', !showCount);
        document.querySelector('.col-time').classList.toggle('hide-col', !showTime);

        document.getElementById('billBody').innerHTML = tableHtml;
        document.getElementById('ketQua').style.display = 'block';
        document.getElementById('btnCopy').style.display = 'block';
        
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function copyBill() {
        const rows = document.querySelectorAll("#billTable tr");
        let text = "üè∏ BILL C·∫¶U L√îNG " + new Date().toLocaleDateString('vi-VN') + "\n";
        text += "--------------------------\n";
        rows.forEach((row) => {
            const cols = row.querySelectorAll("td:not(.hide-col), th:not(.hide-col)");
            let rowText = "";
            cols.forEach((col, idx) => {
                rowText += col.innerText + (idx === cols.length - 1 ? "" : " | ");
            });
            text += rowText + "\n";
        });
        navigator.clipboard.writeText(text).then(() => alert("ƒê√£ copy bill!"));
    }
</script>
</body>
</html>
